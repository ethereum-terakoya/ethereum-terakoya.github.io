---
title: 第2回「Ethereum 2.0」
date: 2021-02-04
slug: eth2-2
group: ethereum2.0
---

## ワーキンググループ報告書

公開ワークショップの資料は以下で公開しています。

<div class="blog-block">
  <ul>
    <li>
      <a href="/pdf/eth2.0/Eth2_Data_Sharding.pdf" target="_blank">
        Eth2 Data Sharding
      </a>
    </li>
    <li>
      <a href="/pdf/eth2.0/rollup-overview.pdf" target="_blank">
        Rollupとは何か
      </a>
    </li>
  </ul>
</div>

## 公開ワークショップ動画

公開ワークショップの動画は以下で公開しています。

<div class="blog-block">
  <ul>
    <li>
      <a href="https://www.youtube.com/watch?v=Kg9bl5uSKYg" target="_blank">
        スケーリング技術によるこれからのEthereum
      </a>
    </li>
  </ul>
  <p class="sub">
    ⇒
    <a
      href="https://www.youtube.com/channel/UCnfgzeNn_90Iq6MHXO3wp5A"
      target="_blank"
    >
      ETHTerakoya Youtubeアカウント
    </a>
  </p>
</div>

## 構成

1. Overview
   1. スケーリング技術によるこれからの Ethereum
2. Detail
   1. ETH2 Data Sharding | 中村 龍矢
   2. Rollup 技術外観 | 部谷 修平
   3. ディスカッション・質疑応答 | 中村 龍矢、部谷 修平、石黒 一明

## 登壇者

- 中村 龍矢：
  株式会社 LayerX, 執行役員

- 部谷 修平
  株式会社 Cryptoeconomics Lab, CTO

- 石井 敦：
  クーガー株式会社, CEO

- 石黒 一明：
  クーガー株式会社, チーフブロックチェーンアーキテクト

## Overview

### 1-1. スケーリング技術によるこれからの Ethereum

2020 年に Beacon chain が実装され、Ethereum は着実に進化を続けている。

今回は Ethereum の現状と併せて、実装予定である Rollup・Shard などの機能も含めた今後の展開について、ユーザー視点と開発者視点双方から情報提供が行われた。

Ethereum2.0 には未確定な要素も多いが、スケーリングによる加速度的な機能の向上が期待できる。今後も世界的な Defi の盛況が続く事が予想されるため、Ethereum の価値は更に高くなると思われる。

Ethereum に関心があれば、公式 Spec の閲覧はよい学習ソースとなる。多くのの人が関心を持ち、参加する事が未来のインフラを強く輝かせる原動力となる。

## Detail

### 2-1. ETH2 Data Sharding

<p style="margin-top: -1em;font-weight: bold;font-size: 1.2em;margin-left: 1em;">
  株式会社LayerX, 執行役員｜中村 龍矢
</p>

![ETH2 Data Sharding](./images/part1.png)

#### 2-1-1 Ethereum のスケーリング概況

①Ethereum の動向について

- 2020 年は Defi(分散型金融)の盛況もあり、トランザクション手数料が高騰した。そのため、今後は Ethereum のスケーリングが急務となっている。

- Ethereum のスケーラビリティは TPS(TX/秒)を基準としており、今後は以下のように改善されていくとされている。

<div style="border-left: 5px #d3d3d3 solid;padding-left: 1em;margin-left: 1em;">
15TX/秒(現在)

⇒2,000TX/秒(Rollup 後)

⇒10,000TX/秒(Ethereum2.0 Data Sharding 後)

</div>

<div style="padding-left: 1em;margin-left: 1em;">
  数値は参考値ではあるが、RollupとData Shardingよる大幅な改善が期待されている。
</div>

②Rollup 概要

- Rollup とはオフチェーンでトランザクションの検証や状態遷移を行い、結果のみをメインチェーンに書き込む方法である。検証をオフチェーンで行う事により、メインチェーンの動作が効率化され TPS の数値が向上する。
  検証方法としては、ZK-SNARKs で検証の正しさを証明(ZKRollup)し、不正な状態遷移を Fraud proof で証明 (Optimistic Rollup) することとなる。

- 2020 年の 12 月に Eth2 の Beacon chain がローンチされたが、単体では使えない状態であり、あくまで最初の一歩という段階である。Beacon chain はシステム全体を管理する重要な役割を持っており、今後機能が追加されていく事で実用化に近づいていく。

- Sharding はブロックチェーンを何本も並列に走らせることであり、最初は Rollup のデータを乗せる用途で実装する。各 Shard に Rollup のデータを乗せることにより、Rollup のキャパシティ圧迫を抑制し、ポテンシャルをより引き出せるようになる。

- ETH1 と ETH2 はしばらくの間は共存し、平行して動き続ける事になる。今後は ETH2 の Shard からトランザクションデータを参照する事が可能となり、Rollup の作業が効率化される。

- Shard にコントラクトを乗せるという案も出ているがまだ検討段階である。

③ 公式 Spec の確認

- 技術詳細は常に変化していくものであるため、情報を確認するには公式 Spec を見る事が必要である。基本的に公式 Spec 以外の資料はメンテナンスされていない。

- 公式 Spec は GitHub で管理されており、言語には Python が使われている。

- Beacon chain のページにはオンチェーンでの状態遷移のロジックが記載されており、コンセンサスについては Honest Validator のページに記載がある。

- Data Sharding についてはまだ策定中であり、メインブランチにはマージされていない。Beacon chain のプルリクエストページには Sharding の記載があるため、そこで内容を確認できる。

- 2021 年の夏にはハードフォークが行われる予定があり、ライトクライアントについての情報も Spec を見れば確認できる。

---

**中間質疑**

**Q：**Spec は誰がどのようなプロセスで決定するのか。

**A：**大きな変更については Spec に記載する前に Ethereum Foundation のチームメンバーが研究を行い、検証を終えてから記載される。小さな Fix に関しては ETH2 のメンバーにマージの権限がある。

**Q：**Beacon chain のローンチで技術的な問題は出てくるか。

**A：**Beacon chain 実装後からスラッシングの問題がたびたび起きている。多くはミスにより発生したものであるが、今後の設計をしていく上での課題となる。

**Q：**ETH2 はクライアントの多様化を常に意識しているように見えるが、多くのノード運営者に支持されるのは、安定稼働する一部のクライアントのみである。そのような現状でありながら多様化は本当に実現可能なのか。

**A：**利用者の少ないクライアントの利用に対し、多くのインセンティブを与えるなどの対応を行っている。しかしクライアントを選ぶには様々な要因が絡むため、今後の大きな課題だと言える。

**Q：**ETH2 を理解するには ETH1 の知識は必要か。

**A：**ETH2 は ETH1 の問題点を改善しているため、前提知識として ETH1 を知っておく事は大事。ただし、必ずしも全てを知っておく必要はない。

**Q：**Sharding について、DAPS のエンジニアが準備すべき事はあるか。

**A：**ETH1 から ETH2 への変更点は非常に多く、簡略化できるようにする取り組みも行われている。しかし、なお対応すべき部分は多いため、スマートコントラクトの作り方を変える等の作業は必要である。

### 2-2 Rollup 技術外観

<p style="margin-top: -1em;font-weight: bold;font-size: 1.2em;margin-left: 1em;">
  株式会社Cryptoeconomics Lab, CTO｜部谷 修平
</p>

![Rollupとは何か](./images/part2.png)

#### 2-2-1 Rollup とは何か

- Rollup とは Data Availability を保ちながらスループット(1 秒間に処理できるトランザクションの数)を向上する技術である。

- Plasma では Markle Root のみをブロックチェーンに投入し保存していたが、Rollup では全体(Calldata)をブロックチェーンに投入し Markle Root のみを保存(State)するようになっている。

- 現在の Ethereum の State サイズは 45GB、Chain Size は 300GB となっている。State はチェックのために毎回メモリに保存する必要があえい、サイズは小さい方が良い。

- Plasma ではトランザクションを圧縮するために、元のトランザクションを解析する必要があったが、Rollup では Call Data によって全てのトランザクションを投げてしまうため、Data Availability が無くなるような問題は解消されている。

- Rollup には Optimistic Rollup と ZK Rollup がある。Optimistic Rollup は問題が起こった場合のみブロックチェーンでトランザクションの検証を行うものであり、ZK Rollup は(zk-)SNARK により毎回ブロックチェーンでトランザクションの検証を行う。

- Rollup による Gas コスト削減は複雑なトランザクションほど効果がある。

- 『ブロックあたりの最大トランザクション値』は block gas limit を『tx 当たりの gas』で割れば求められる。ただし ZK Rollup では circuit サイズと証明生成時間がボトルネックとなる。

#### 2-2-2 なぜ Rollup なのか

Rollup を用いる事で Data Availability を犠牲にすることが無くなり自由度が高まる。

①Optimistic Rollup について

- Optimistic Rollup によりアグリゲータがパーミッションレスになった。また、EVM との互換性を持たせやすくなっている。

- 紛争期間があるため、引き出しには 1 週間程度かかる。

- Rollup ではデータが公開されているため誰でも不正の検証が可能である。

- EVM 互換の状態遷移で不正証明を可能にする仕組みとして OVM(Optimistic Virtual Machine)がある。

②ZK Rollup について

- Optimistic Rollup と同様にアグリゲータはパーミッションレスである。

- 引き出しの時間が早く、数分程度で行える。

- プログラムのサイズに制約があるため複雑な動きができない。そのため、スマートコントラクトの開発にも制約がある。

- Optimistic Rollup と比較してセキュリティ面でのアドバンテージがある。

- 全てのフルノードに引き出し要求を無視された場合、オンチェーンに直接引き出し要求ができる。(Exodus Mode)

- ZK Rollup ではブロックが正しいことが検証できているため、安全性のための十分なバリデーターを想定する必要がなく、ユーザビリティが高い。

③Optimistic Rollup と ZR Rollup の比較

- レイテンシ(トランザクションが検証可能になるための時間)は Optimistic Rollup よりも ZK Rollup のほうが早い。

- プログラマビリティの面では、Optimistic Rollup が EVM 互換性を持たせられるため汎用性が高い。ZK Rollup はクセはあるが Cairo や zinc で大幅に改善されてきている。

- Optimistic Rollup は複数のバリデーターに分散する必要はあるが、安いマシンで運用できるためコスト面に優れている。ZK Rollup の運用にはハイスペックが求められるためコストが高く、スループットを向上させるには更に複数台のマシンが必要となる。

- Optimistic Rollup は安全性を保つため、引き出しに一定の検閲耐性が必要となる一方、ZK Rollup は引き出しなどが検閲されても資産は安全に保たれる。その場合にも、zk-SNARKS プロトコルによってはセットアップした人を信頼しなければいけない場合があるため、注意が必要である。

---

**中間質疑**

**Q：**問題が起きた時にのみ発動する Optimistic Rollup の検証はどれくらいの時間を要するか。

**A：**プロダクトによって検証を行う範囲が異なるため、範囲が広ければ時間は長引き、1 カ所のみで済むのであれば短時間で完了する。

**Q：**Rollup で OpenSea のような NFT の SWAP は可能か。また、既存のコントラクトを捨てなければならないのか。

**A：**Optimism はそのまま、コントラクトを使用する事は可能である。

**Q：**Rollup には規格の標準をつくる様な動きはあるか。

**A：**Plasma の頃から幾度も試みているが、目的によって中身が異なるため実現は出来ていない。

**Q：**OVM はどのような仕組みで動くのか。

**A：**内容は非常に複雑である。

EVM のステートトランジションを再現する仕組みと、それを再現するためのプルーフを生成させるためのクライアントは別々に存在する。既存のソリディティコードをトランスファイルし、OVM 用のバイトコードに変えてデプロイするとステートトランジションが再現されるようになっている。

### 2-3 Panel Discussion

![Panel Discussion](./images/session.png)

#### ◆Phase0 その後

**石黒：**
Phase0.5 と呼ばれていたライトクライアントのサポートは 2021 年の初旬を予定していたが、どのような状況か。

**中村：**
「ハードフォーク 1」というファイル名のドキュメントが入ってきており、現在は夏季を目標にライトクライアントのサポート・バグ対応を行っている様子。

**石黒：**
Sharding も夏の導入になるか。

**中村：**
Sharding は PtoP の部分が大きく変わるため、抜本的な工事が必要となる。Beacon chain を 0 から作る様なものであり、非常に難しく時間が掛かると思われる。

**石黒：**
Sharding の実装を行うチームは決まっているか。

**中村：**
未定である。Spec は進んでいるが、実装がその速度に追い付いていない状態である。

**石黒：**
Sharding のツールなどは出て来ているか。

**中村：**
全くと言っていい程出てきていない。ETH2 が完成する前に、簡易的に試せるようなツールは作成しておきたいと考えている。

**石黒：**
CBC Casper の脆弱性についての論文を書かれていますが、どのような経緯で問題を検知したのか。

**中村：**
2 年程前に CBC 　 Casper の研究をした事がきっかけ。その中であらゆるケースのシミュレーションを行った事で問題を検知した。

**石黒：**
Sharding 後のマージなどにリスクは無いか。

**中村：**
リスクよりもコミュニティが賛成するかどうかが重要と考える。マージするには現行の Ethereum を止めて引っ越しを行う必要があり、それにはコミュニティの理解が必要不可欠です。技術的には早期にマージを行うほうが良いです。

**部谷：**
ユーザビリティやデベロッパーのエクスペリエンスに関わる、大きな変化が起きるところには影響が出ると思う。Rollup や Shard・ETH1 などが絡むと更に複雑になるのではないか。

**石黒：**
ETH2 移行時にプールされている流動性のデータなどはリセットされるのか。

**中村：**
Shard 側に EVM が無いために Beacon chain を ETH1 とほぼ同様にするので、データはそのままコピーされると思われる。

**石黒：**
Plasma が広く受け入れられなかった理由についてどのようにとらえるか。

**部谷：**
原因として考えられるのは分散性の問題。アグリゲータがパーミッションレスかどうかで資産の安全性が変わってくるため、そこがネックとなったのではないか。

**中村：**
Plasma の場合は明確にオーナーが決まるアプリケーションではないという点もある。Plasma は自分の持ち物は自分で守るという仕組みであり、オープンなアプリケーションではないので組み込みにくいという問題がある。

**石黒：**
Markle Tree ではハッシュ 関数を使うが、全て同じものを使用するのか。

**部谷：**
同じものを使う可能性もあるが、ハッシュには様々な使い方があり一概に全て同じとは言えない。標準化はされていないが、基準の様な物は公表されている。

**石黒：**
ツールなどはどの様な物があるか。

**部谷：**
自分は OVM コンパイラーを使用している。ほかに有名な物であれば Zinc という zkSync 用のアプリケーションを作るコンパイラーがある。

**石黒：**
Phase1.5 とのドッキングの話もあるが、どのような見解を持っているか。

**中村：**
柔軟なプログラムが実行されるという事、柔軟なプログラムをデプロイ出来るキャパシティがあるという点で違いがある。そのため柔軟な実行環境も必要となってくると考えている。
EVM の強みは、EPM という柔軟な実行環境自体が状態遷移を行うという事であり、それによりデプロイ時点では想定していなかった様なアプリケーションができる可能性が生まれること。現在、EMP の貢献により Ethereum 上でローンチ時点では誰も想定できなかったようなプロジェクトが多数動いている。そのような環境を作った事が Ethereum の本質的な価値ではないかと思う。

**石黒：**
今後 proof of stake や Sharding はどのように変わっていくか。

**中村：**
複数の Shard を用意しても、全員が同じ Shard にれば意味が無いという問題は Data Sharding によって解決されるはず。Shard に乗るのが Data だけであれば大きな負荷にはならないため、偏っても問題にはならない。これらの理由から「Sharding」という表現は不適切であり、もはや 1 つのブロックと表現したほうが適切ではないかと思う。
proof of stake に関しては個人的に非常に重要だと感じている。proof of work は環境に悪く、proof of stake は環境に良いと言われているが、その問題に無関心な人は多い。しかし、Ethereum は次世代に残すためのインフラであり、環境問題について、深く考えるべきである。

**石黒：**
今後ユーザー側の行動に変化は出るか。

**部谷：**
短期的にはお金の流れ次第ではないか。お金が流れればユーザー・開発者ともに集まる。長期的には、次世代に残せるような汎用的で正しいものが好まれると考える。
